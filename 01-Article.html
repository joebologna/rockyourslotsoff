<h1 id="product-development-cradle-to-grave---part-1">Product
Development Cradle to Grave - Part 1</h1>
<p>This series of articles is designed as a tutorial for how to write a
portable full stack service using modern techniques. I will take you on
a journey from concept through deployment. The series will be detailed
and therefore is closer to a book than a bunch of blog posts. Hopefully
we’ll all learn something along the way. I’ll strive to make the series
useful for software engineers at any point in their career. I will
incorporate how I approach doing product development which has worked
well when working with teams over my career.</p>
<h1 id="converting-a-concept-to-a-commitment">Converting a Concept to a
Commitment</h1>
<p>A concept can come from anyone. In any product development someone
must play the role of product manager. The product manager decides if a
concept can be developed, funded and become an asset in the portfolio
they responsible for. Most businesses are successful because they solve
a problem better than other businesses by providing a product or service
with a positive return on investment (ROI).</p>
<p>For this series, I’m playing all roles for illustration purposes.
This is unusual, but it is not unrealistic. Few companies can afford to
staff each role in product development with a dedicated resource. This
requires employees to play different roles. I’ll refrain from the issues
regarding individuals capabilities to perform the roles they have been
assigned (explicitly or implicitly), instead I will assume every role is
staffed properly.</p>
<p>When a concept is proposed by the product manager, it is necessary to
determine what it will cost to develop it as soon as possible. If the
estimate has a digestible cost/benefit ratio (ROI). This normally
communicated using a written report or is the result of a number of
discussions.</p>
<p>The communication addresses the following:</p>
<ul>
<li>A description of the problem the product solves for targeted
customers</li>
<li>A straw man proposal of the features a product provides to solve the
problem</li>
<li>Proposals for how to solve the problem</li>
<li>Proposals for the User Experience (UX) expected</li>
<li>A straw man system and software architecture</li>
<li>A straw man estimate of the resources required to take the product
from “cradle to grave”</li>
</ul>
<p>Given this information ROI can be estimated. The volume of revenue
can be estimated which determines the value of the product. If the
profits expected are attractive and the non-recoverable expense (NRE) is
affordable, a project to start building the product is approved and the
product manager commits to delivering it.</p>
<p>For the moment, none of these issues are relevant to the objective of
demonstrating how to write a portable full stack service. Therefore, I
will address these issues in other articles. For now, I’ll assume the
project to start building the product has been approved and just get
down to work. After all, I’m funding the product development myself so I
can do whatever I want :)</p>
<h1 id="concept-rock-your-slots-off">Concept: Rock Your Slots Off</h1>
<p>I was recently asked how to take data stored in a RocksDB and report
it using a web page. To answer this question using some research I’ve
decided to create a <strong>slot machine simulator</strong> as the basis
of a fictional “Rock Your Slots Off” product. This is a pun on “Rock
your Socks Off”, which hopefully makes people want to use it.</p>
<p>I want it to be usable from a browser, desktop or mobile device.
Therefore a service running on a server in the cloud is needed. I’ll
host it on a website I’ve been running for years and interact with it
using various clients. One of the clients is a web page served from the
cloud server itself. It is desirable for the server to be a single
binary for prototyping and deployment for a small user base. Using the
proper technologies to implement the server allows running it as a
co-routine or thread in another service.</p>
<p>There are two ways to approach this, using a scripting language or
using compiled code that can be linked in as a library and started in
any binary that wishes to use it.</p>
<h2 id="using-a-scripting-language-for-the-server">Using a Scripting
Language for the Server</h2>
<p>NodeJS or Python or other scripting languages are well suited to the
task of creating services. However, some engineers just don’t trust that
a server written using a scripting language can satisfy performance
requirements. This is usually because the service must have a minimum
response time and be able to serve many clients concurrently. The
simplest metric is the number transactions per second the server must be
able to handle given the hardware selected. So, we’ll use a compiled
language as engineers concerned with perform accept implicitly that
C/C++ is the fastest technology to use. I won’t argue this point here to
simplify matters.</p>
<h2 id="using-a-compiled-language-for-the-server">Using a Compiled
Language for the Server</h2>
<h3 id="go-lang">Go Lang</h3>
<p>In recent years, I’ve found using Go Lang the most cost effective
technology to use. This assumes the binary supplying the service is
written in Go. If this is not the case, the code can be incorporated
using a shared library. This would require linking the library into the
binary an starting a thread of some sort to invoke the code. Doing this
is complicated and therefore not necessary because this is a green field
situation. So I’ll use a Go binary for illustration purposes.</p>
<h3 id="c">C++</h3>
<p>The most portable high performing language is still C++. There are
advantages and disadvantages to using it, but it will running on any
platform and can be called from any other language you’ll run into. So
I’ll use a C++ as a second implementation. This allows me to compare the
effort between using Go and C++ as the underlying technology.</p>
<h2 id="using-a-browser-for-the-client">Using a Browser for the
Client</h2>
<p>Every browser supports JavaScript and therefore this language is used
on the client.</p>
<h2 id="using-a-mobile-device-for-the-client">Using a Mobile Device for
the Client</h2>
<p>Creating a mobile application is a real pain. iOS and Android are
fundamentally different and therefore a common code base is not possible
for native applications. It is possible to use frameworks and languages
that generate native applications, but we’ll skip this as I want to
focus on the server.</p>
<p>The simplest way for me to give you code to use on a mobile device is
to use Pythonista for iOS. Sorry Android users, feel free to write your
own client. Install the Pythonista on your iOS device and you’ll be able
to run the Python code I supply. Pythonista cost $9.99 (one time), so
you’ll need to make a small investment to use it. I promise it’s worth
it’s weight in gold. You’ll learn Python 3.10 in the process.</p>
<h2 id="selecting-persistent-storage-for-the-server">Selecting
Persistent Storage for the Server</h2>
<p>I’ll get to the overall architecture in a minute, but obviously we
need some way to persist data. All services require some form of
configuration data and user data. Persistence is required when making
updates to the binary providing the service because it will restart.
Keeping user data safe and dealing with changes to configuration or user
data data structures is important.</p>
<p>There are many ways to persist data. I’m going to try using RocksDB
for the first time. It’s a high performance key/value database that
doesn’t seem to need a service running. Let’s call this a hard
constraint the solution needs to address.</p>
<h1 id="system-architecture">System Architecture</h1>
<p>Now that we have some idea of what needs to be done, requirements and
constraints we can create a straw man architecture. There a many ways to
do this. I’ve found diagrams useful myself, so we’ll start there.</p>
<h2 id="using-mermaid-chart">Using Mermaid Chart</h2>
<p>Manually drawing diagrams is a time consuming process and difficult
to maintain. Using more formal tools can be expensive (I’ll skip the
discussion on this), but can generate code. I’ve not found the overhead
of doing this for small systems worth the expense and effort.</p>
<p>I recently discovered the Mermaid language for describing a diagram
that cen then be rendered in VS Code. I also found a service that
provides for creating charts from text. <a
href="https://mermaichart.com">MermaidChart</a> is a website where you
can create diagrams with an account for free, but to get the AI feature
there is a subscription fee. I paid the $80/year fee a while back. It
will be easier for you to understand how I use AI for architecture if
you can use the tool, otherwise just read along.</p>
<h3 id="prompting-mermaid-chart">Prompting Mermaid Chart</h3>
<p>The AI Chat feature is very powerful. We’ll start by using a prompt
to generate a system architecture devoid of behavior. This partitions
functionality (i.e. establishes responsibilities to difference
subsystems) which are implemented as services that are interacted with
using interfaces.</p>
<p>Let’s start by describing what we want to see:</p>
<pre><code>Draw me a chart showing a server that contains a database. The server implements a service that serves up a web page containing a virtual slot machine. The web page accepts fake money and provides a button to activate a spin. The service randomly generates the result of the pull, determines the result and credits or debits the balance accordingly. A report showing % win and current balance is displayed on the webpage.</code></pre>
<p>Response:</p>
<pre class="mermaid"><code>flowchart TD
    %% Nodes
    Server(&quot;Server&quot;)
    Database(&quot;Database&quot;)
    Service(&quot;Service&quot;)
    WebPage(&quot;Web Page&quot;)
    FakeMoney(&quot;Fake Money&quot;)
    ActivateSpinButton(&quot;Activate Spin Button&quot;)
    SpinResult(&quot;Random Spin Result&quot;)
    DetermineResult(&quot;Determine Result&quot;)
    UpdateBalance(&quot;Update Balance&quot;)
    Report(&quot;Report: % Win and Current Balance&quot;)

    %% Relationships
    Server --&gt; Database
    Server --&gt; Service

    Service --&gt; WebPage
    WebPage --&gt; FakeMoney
    WebPage --&gt; ActivateSpinButton

    ActivateSpinButton --&gt; SpinResult
    SpinResult --&gt; DetermineResult
    DetermineResult --&gt; UpdateBalance
    UpdateBalance --&gt; Report

    Report --&gt; WebPage</code></pre>
<p>TODO: Add the PNG here</p>
<p>This isn’t bad. Let’s try to partition the system by providing an
additional prompt:</p>
<pre><code>Convert the diagram to a collaboration diagram</code></pre>
<p>Result:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant WebPage as Web Page
    participant User as User
    participant Server as Server
    participant Database as Database
    participant Service as Service
    participant Report as Report

    User-&gt;&gt;WebPage: Inserts Fake Money
    User-&gt;&gt;WebPage: Clicks Activate Spin Button
    WebPage-&gt;&gt;Service: Request Spin Result
    Service-&gt;&gt;Database: Fetch Current Data
    Database--&gt;&gt;Service: Send Data
    Service--&gt;&gt;WebPage: Send Random Spin Result
    WebPage-&gt;&gt;Service: Send Spin Result for Calculation
    Service-&gt;&gt;Database: Update Balance
    Service--&gt;Report: Generate Report
    Report--&gt;&gt;WebPage: Display % Win and Current Balance</code></pre>
<p>This looks pretty good. The actors are partitioning responsibilities.
Now we need to show how communications are performed between the
different actors. This is a little more difficult to chart.</p>
<p>Let’s ask the AI to add more details:</p>
<pre><code>Update the diagram so show using a websocket for communication between the browser and the server. Rename the database &quot;rocksdb&quot; and show using the rocksdb API to access the database.</code></pre>
<p>Result:</p>
<pre class="mermaid"><code>sequenceDiagram
    participant WebPage as Web Page
    participant User as User
    participant Server as Server
    participant RocksDB as RocksDB
    participant Service as Service
    participant Report as Report

    User-&gt;&gt;WebPage: Inserts Fake Money
    User-&gt;&gt;WebPage: Clicks Activate Spin Button
    WebPage-&gt;&gt;Server: WebSocket Connect
    WebPage-&gt;&gt;Server: Request Spin Result
    Server-&gt;&gt;Service: Delegate Request to Service
    Service-&gt;&gt;RocksDB: Fetch Current Data (RocksDB API)
    RocksDB--&gt;&gt;Service: Send Data (RocksDB API)
    Service--&gt;&gt;Server: Send Random Spin Result
    Server--&gt;&gt;WebPage: WebSocket: Send Spin Result
    WebPage-&gt;&gt;Server: WebSocket: Send Spin Result for Calculation
    Server-&gt;&gt;Service: Delegate Update Balance
    Service-&gt;&gt;RocksDB: Update Balance (RocksDB API)
    Service--&gt;Report: Generate Report
    Report--&gt;&gt;Server: Send Report
    Server--&gt;&gt;WebPage: WebSocket: Display % Win and Current Balance</code></pre>
<p>Let’s try to get a static view using this prompt:</p>
<pre><code>Suggest how to convert this diagram to show processes in more static representation, similar to a block diagram</code></pre>
<p>Result:</p>
<p>Converting a sequence diagram to a more static representation akin to
a block diagram involves representing the processes and their
relationships without the detailed step-by-step interactions. Below is
an example of how you could represent the system using a block
diagram:</p>
<pre class="mermaid"><code>flowchart TD
    %% Nodes
    User(User)
    WebPage(Web Page)
    WS(WebSocket)
    Server(Server)
    Service(Service)
    RocksDB(RocksDB)
    Report(Report)

    %% Relationships
    User --&gt;|Interacts with| WebPage
    WebPage --&gt;|Uses| WS
    WS --&gt;|Connects to| Server
    Server --&gt;|Delegates to| Service
    Service --&gt;|Accesses via RocksDB API| RocksDB
    Service --&gt;|Generates| Report
    Report --&gt;|Displays on| WebPage
    Server --&gt;|Sends Data to| WebPage</code></pre>
<p>Explanation:</p>
<p>User: Represents the user who interacts with the system.<br> Web
Page: This is the front-end that the user sees and interacts with.<br>
WebSocket (WS): Represents the communication channel used by the Web
Page to talk to the Server.<br> Server: The backend server that
processes requests.<br> Service: The business logic layer that handles
specific tasks like spin result generation and balance update.<br>
RocksDB: The database, accessed by the Service using RocksDB API.<br>
Report: The report generated by the service showing % win and current
balance, which is then sent back to be displayed on the Web
Page.<br></p>
<p>Relationships:</p>
<p>The User interacts directly with the WebPage.<br> The WebPage uses
WebSocket to communicate with the Server.<br> The Server delegates tasks
to the Service.<br> The Service accesses data from RocksDB via the
RocksDB API.<br> The Service generates a Report which is then sent back
to the WebPage.<br> The Server sends data back to the WebPage via
WebSocket.<br> This block diagram representation simplifies the
interactions and focuses on the static relationships and data flow
between the different components of the system.<br></p>
<p>This looks pretty good, let’s run with it.</p>
<h1 id="assessment">Assessment</h1>
<p>This gives a pretty good idea of what it will take to create a
prototype. This is often called “Iteration 0” in Agile methodologies.
Using the project description, technologies required and other details
above it is actually possible to determine how much effort getting this
platform created. Taking the platform to a usable prototype (i.e. a web
page) is an incremental effort, say the same amount of effort as the
platform.</p>
<p>I don’t know how to teach estimation quickly, so I’ll just take an
educated guess and assume you’ve done some development on the computer
you have already. VS Code is installed and native compilers are
available. This is different for Linux, Windows and MacOS. I have this
all setup on MacOS, so I’m assuming this.</p>
<table>
<colgroup>
<col style="width: 89%" />
<col style="width: 10%" />
</colgroup>
<thead>
<tr>
<th>Task</th>
<th>Effort</th>
</tr>
</thead>
<tbody>
<tr>
<td>Setup dev environment for Go, C++ and VS Code</td>
<td>1</td>
</tr>
<tr>
<td>Write slot machine "business logic" using TDD</td>
<td>3</td>
</tr>
<tr>
<td>Create API to use slot machine business logic</td>
<td>2</td>
</tr>
<tr>
<td>Create a simple web page<sup>[1]</sup></td>
<td>3</td>
</tr>
<tr>
<td>Write design the API to invoke the business logic<sup>[2]</sup></td>
<td>2</td>
</tr>
<tr>
<td>Write the code to format the web page</td>
<td>2</td>
</tr>
<tr>
<td>Write code to display msg from server<sup>[3]</sup></td>
<td>3</td>
</tr>
<tr>
<th>Total Effort</th>
<th>16</th>
</tr>
</tbody>
</table>
<p><sup>[1]</sup> Start with fake money, button to push, display results
and reset progress. Assume DIVs will be updated from the server to
display progress.<br> <sup>[2]</sup> Use a websocket for messages.
Assume the messages “reset and spin” are all that is needed.<br>
<sup>[3]</sup> When a “display” message is received over the websocket
update the “divs”.</p>
<p>16 hours seems like a lot. We can try doing some of the work to get a
better estimate. By using AI and other techniques I’ll bet starting the
process will result in a good framework in about 4 hours and the actual
implementation will be less than 8. This is 12 hours of which 8 hours is
spent writing code for Alpha testing.</p>
<h2 id="setting-expectations">Setting Expectations</h2>
<p>It’s a good idea to target doing an Alpha test with Iteration 0. Demo
it to the product owner and get feedback. Using the feedback you can
start working on a UX and other features required. This will help
estimating completing the first article for a full fledged Alpha test,
which is then followed by completing the product, performing QA and
deploying it.</p>
<p>For a system of this size and with minimal UX and additional features
to support, it’s reasonable to assume getting to the first deployment
and performing a Beta test will take 2-4x what it took to get to Alpha
test.</p>
<p>Using this formula, with 3x therefore:</p>
<pre><code>Effort to Beta Test = 12+12*3 = 48 hours</code></pre>
<p>That’s about a week full time. Typical for something of this
nature.</p>
<p>How do I know this? It was my job for 10+ years at my last company
and many years prior at previous companies. So, it’s partially
intuition. But, since many of my demos are similar to this one and they
usually took 3-5 days. It’s a pretty good estimate.</p>
<p>For a larger project, you’ll need to find similar prior art, ask some
questions of the implementors and make your educated guess. For
instance, we needed to write a “functional tester”, so we asked someone
who created one from scratch what it took. He said 1.5 Full Time
Engineers (FTE). He described what he did and we compared the work
breakdown to our project and felt it was comparable. This was far in
excess of the budget, so we managed expectations to deliver successive
Alpha releases until it was completed. Completing the project took 18
months with 1 engineer. In the beginning 0.25 FTE was provided in
parallel (two people working at the same time). So the 0.25 FTE
de-risked the program.</p>
